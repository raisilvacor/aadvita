{% extends "admin/base.html" %}

{% block title %}Contas{% endblock %}

{% block page_title %}Contas - Doa√ß√µes e Gastos{% endblock %}

{% block content %}
<!-- Cards de Estat√≠sticas -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="admin-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
            R$ {{ "%.2f"|format(total_doacoes_financeira) }}
        </div>
        <div style="font-size: 1rem; opacity: 0.9;">
            üí∞ Total de Doa√ß√µes Financeiras
        </div>
    </div>
    
    <div class="admin-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
            {{ total_doacoes_material|int }} itens
        </div>
        <div style="font-size: 1rem; opacity: 0.9;">
            üì¶ Total de Doa√ß√µes em Material
        </div>
    </div>
    
    <div class="admin-card" style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white;">
        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
            {% if total_doacoes_servico_por_unidade %}
                {% for unidade, total in total_doacoes_servico_por_unidade.items() %}
                    <div style="margin-bottom: 0.5rem;">
                        {{ total }} {{ unidade }}
                    </div>
                {% endfor %}
            {% else %}
                0 unidades
            {% endif %}
        </div>
        <div style="font-size: 1rem; opacity: 0.9;">
            üõ†Ô∏è Total de Doa√ß√µes em Servi√ßos
        </div>
    </div>
    
    <div class="admin-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
            R$ {{ "%.2f"|format(total_gastos) }}
        </div>
        <div style="font-size: 1rem; opacity: 0.9;">
            üí∏ Total de Gastos
        </div>
    </div>
</div>

<!-- Se√ß√£o de Doa√ß√µes -->
<div class="admin-card" style="margin-bottom: 2rem;">
    <div class="admin-card-header">
        <h2 class="admin-card-title">Doa√ß√µes</h2>
        <a href="{{ url_for('admin_doacao_novo') }}" class="btn-admin btn-admin-primary">
            <span>‚ûï</span> Nova Doa√ß√£o
        </a>
    </div>
    
    <div class="admin-table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Tipo</th>
                    <th>Descri√ß√£o</th>
                    <th>Doador</th>
                    <th>Pa√≠s</th>
                    <th>Telefone</th>
                    <th>Documento</th>
                    <th>Valor/Quantidade</th>
                    <th>Data</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% if doacoes %}
                    {% for doacao in doacoes %}
                    <tr>
                        <td>
                            {% if doacao.tipo == 'financeira' %}
                                <span style="background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.875rem; font-weight: 600;">
                                    üí∞ Financeira
                                </span>
                            {% elif doacao.tipo == 'material' %}
                                <span style="background: #3b82f6; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.875rem; font-weight: 600;">
                                    üì¶ Material
                                </span>
                            {% elif doacao.tipo == 'servico' %}
                                <span style="background: #3b82f6; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.875rem; font-weight: 600;">
                                    üõ†Ô∏è Servi√ßo
                                </span>
                            {% endif %}
                        </td>
                        <td>{{ doacao.descricao[:50] }}{% if doacao.descricao|length > 50 %}...{% endif %}</td>
                        <td>{{ doacao.doador or '-' }}</td>
                        <td>
                            {% if doacao.pais %}
                                {% if doacao.pais == 'BR' %}üáßüá∑ Brasil
                                {% elif doacao.pais == 'AR' %}üá¶üá∑ Argentina
                                {% elif doacao.pais == 'UY' %}üá∫üáæ Uruguai
                                {% elif doacao.pais == 'PY' %}üáµüáæ Paraguai
                                {% elif doacao.pais == 'CL' %}üá®üá± Chile
                                {% elif doacao.pais == 'CO' %}üá®üá¥ Col√¥mbia
                                {% elif doacao.pais == 'PE' %}üáµüá™ Peru
                                {% elif doacao.pais == 'BO' %}üáßüá¥ Bol√≠via
                                {% elif doacao.pais == 'VE' %}üáªüá™ Venezuela
                                {% elif doacao.pais == 'EC' %}üá™üá® Equador
                                {% elif doacao.pais == 'US' %}üá∫üá∏ Estados Unidos
                                {% elif doacao.pais == 'ES' %}üá™üá∏ Espanha
                                {% elif doacao.pais == 'PT' %}üáµüáπ Portugal
                                {% else %}{{ doacao.pais }}
                                {% endif %}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ doacao.telefone or '-' }}</td>
                        <td>
                            {% if doacao.documento %}
                                {% if doacao.tipo_documento == 'cpf' %}
                                    {{ doacao.documento[:3] }}.{{ doacao.documento[3:6] }}.{{ doacao.documento[6:9] }}-{{ doacao.documento[9:] }}
                                {% elif doacao.tipo_documento == 'cnpj' %}
                                    {{ doacao.documento[:2] }}.{{ doacao.documento[2:5] }}.{{ doacao.documento[5:8] }}/{{ doacao.documento[8:12] }}-{{ doacao.documento[12:] }}
                                {% elif doacao.tipo_documento in ['cuil', 'cuit'] %}
                                    {{ doacao.documento[:2] }}-{{ doacao.documento[2:10] }}-{{ doacao.documento[10:] }}
                                {% elif doacao.tipo_documento == 'rut_empresa' %}
                                    {{ doacao.documento[:2] }}.{{ doacao.documento[2:5] }}.{{ doacao.documento[5:8] }}-{{ doacao.documento[8:] }}
                                {% elif doacao.tipo_documento == 'nit' and doacao.pais == 'CO' %}
                                    {{ doacao.documento[:3] }}.{{ doacao.documento[3:6] }}.{{ doacao.documento[6:9] }}-{{ doacao.documento[9:] }}
                                {% elif doacao.tipo_documento == 'rif' %}
                                    {{ doacao.documento }}
                                {% elif doacao.tipo_documento == 'ein' %}
                                    {{ doacao.documento[:2] }}-{{ doacao.documento[2:] }}
                                {% elif doacao.tipo_documento == 'ssn' %}
                                    {{ doacao.documento[:3] }}-{{ doacao.documento[3:5] }}-{{ doacao.documento[5:] }}
                                {% else %}
                                    {{ doacao.documento }}
                                {% endif %}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if doacao.tipo == 'financeira' %}
                                R$ {{ "%.2f"|format(doacao.valor) if doacao.valor else '0.00' }}
                            {% else %}
                                {{ doacao.quantidade or 0 }} {{ doacao.unidade or 'unidades' }}
                            {% endif %}
                        </td>
                        <td>{{ doacao.data_doacao.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <a href="{{ url_for('admin_doacao_editar', id=doacao.id) }}" 
                               class="btn-admin btn-admin-edit btn-admin-small">
                                <span>‚úèÔ∏è</span> Editar
                            </a>
                            <form method="POST" action="{{ url_for('admin_doacao_excluir', id=doacao.id) }}" 
                                  style="display: inline; margin-left: 0.5rem;" 
                                  onsubmit="return confirm('Tem certeza que deseja excluir esta doa√ß√£o?');">
                                <button type="submit" class="btn-admin btn-admin-danger btn-admin-small">
                                    <span>üóëÔ∏è</span> Excluir
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 2rem;">
                            Nenhuma doa√ß√£o cadastrada.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Se√ß√£o de Gastos -->
<div class="admin-card">
    <div class="admin-card-header">
        <h2 class="admin-card-title">Gastos</h2>
        <a href="{{ url_for('admin_gasto_novo') }}" class="btn-admin btn-admin-primary">
            <span>‚ûï</span> Novo Gasto
        </a>
    </div>
    
    <div class="admin-table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Descri√ß√£o</th>
                    <th>Tipo</th>
                    <th>Fornecedor</th>
                    <th>Valor</th>
                    <th>Data</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% if gastos %}
                    {% for gasto in gastos %}
                    <tr>
                        <td>{{ gasto.descricao[:50] }}{% if gasto.descricao|length > 50 %}...{% endif %}</td>
                        <td>
                            <span style="background: #3b82f6; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.875rem;">
                                {{ gasto.categoria or 'N√£o definido' }}
                            </span>
                        </td>
                        <td>{{ gasto.fornecedor or '-' }}</td>
                        <td><strong>R$ {{ "%.2f"|format(gasto.valor) }}</strong></td>
                        <td>{{ gasto.data_gasto.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <a href="{{ url_for('admin_gasto_editar', id=gasto.id) }}" 
                               class="btn-admin btn-admin-edit btn-admin-small">
                                <span>‚úèÔ∏è</span> Editar
                            </a>
                            <form method="POST" action="{{ url_for('admin_gasto_excluir', id=gasto.id) }}" 
                                  style="display: inline; margin-left: 0.5rem;" 
                                  onsubmit="return confirm('Tem certeza que deseja excluir este gasto?');">
                                <button type="submit" class="btn-admin btn-admin-danger btn-admin-small">
                                    <span>üóëÔ∏è</span> Excluir
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem;">
                            Nenhum gasto cadastrado.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

